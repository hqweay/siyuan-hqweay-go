import { EnvConfig } from "@/lets-syplugin-backlink-panel/config/EnvConfig";
import Instance from "@/lets-syplugin-backlink-panel/utils/Instance";
import { CUSTOM_ICON_MAP } from "@/lets-syplugin-backlink-panel/models/icon-constant";
import { getActiveTab } from "@/lets-syplugin-backlink-panel/utils/html-util";
import { TabService } from "@/lets-syplugin-backlink-panel/service/plugin/TabService";
import { openSettingsDialog } from "@/lets-syplugin-backlink-panel/components/setting/setting-util";

export class TopBarService {
  public static get ins(): TopBarService {
    return Instance.get(TopBarService);
  }

  icon = `<svg t="1766245466257" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2577" width="32" height="32"><path d="M577.682286 419.401143c5.412571 4.096 10.532571 8.484571 15.36 13.312l2.486857 2.486857c58.221714 58.221714 58.221714 153.6 0 211.821714l-135.021714 135.021715c-29.110857 29.110857-67.584 43.739429-105.910858 43.739428s-76.8-14.628571-105.910857-43.739428l-2.486857-2.486858c-58.221714-58.368-58.221714-153.6 0-211.968l94.500572-94.354285c-0.438857 27.794286 4.681143 55.734857 15.213714 81.92l-61.001143 61.147428a81.232457 81.232457 0 0 0 0 114.688l2.486857 2.486857a80.852114 80.852114 0 0 0 57.344 23.698286c20.772571 0 41.545143-7.899429 57.344-23.698286l135.021714-135.021714c31.597714-31.597714 31.597714-83.090286 0-114.834286l-2.486857-2.486857c-4.973714-4.973714-10.386286-9.069714-16.091428-12.434285l49.152-49.298286m0-70.802286c-18.285714 0-36.278857 7.021714-50.029715 20.772572l-49.444571 49.444571a70.875429 70.875429 0 0 0-20.187429 58.660571 70.846171 70.846171 0 0 0 33.938286 52.077715c1.609143 1.024 2.194286 1.462857 2.194286 1.609143l0.292571 0.292571 2.486857 2.486857c4.096 4.096 4.096 10.678857 0 14.774857l-135.021714 135.021715c-2.486857 2.486857-5.412571 3.072-7.314286 3.072s-4.827429-0.585143-7.314285-2.925715l-2.486857-2.486857a10.357029 10.357029 0 0 1-3.072-7.314286c0-1.901714 0.585143-4.827429 2.925714-7.314285l61.001143-61.147429a70.656 70.656 0 0 0 15.506285-76.507428 137.815771 137.815771 0 0 1-10.093714-54.418286 70.5536 70.5536 0 0 0-70.656-71.68c-18.432 0-36.425143 7.168-50.029714 20.626286l-94.500572 94.354285a219.574857 219.574857 0 0 0-48.420571 72.996572C137.069714 617.033143 131.657143 644.973714 131.657143 673.499429c0 28.672 5.412571 56.466286 16.091428 82.944 11.117714 27.501714 27.355429 52.077714 48.274286 72.996571l2.486857 2.486857a219.574857 219.574857 0 0 0 155.940572 64.512c28.672 0 56.466286-5.412571 82.944-16.091428 27.501714-11.117714 52.077714-27.355429 72.996571-48.274286l135.021714-135.021714a219.574857 219.574857 0 0 0 64.512-155.940572c0-28.672-5.412571-56.466286-16.091428-82.944-10.971429-27.355429-27.209143-51.785143-48.128-72.850286l-2.340572-2.340571-0.731428-0.731429c-7.021714-7.021714-14.628571-13.604571-22.528-19.456-12.580571-9.508571-27.501714-14.189714-42.422857-14.189714z" p-id="2578"></path><path d="M684.178286 191.926857c38.473143 0 76.8 14.628571 105.910857 43.739429l2.486857 2.486857c58.221714 58.221714 58.221714 153.6 0 211.821714l-94.500571 94.500572c0.438857-27.794286-4.681143-55.734857-15.213715-81.92l61.001143-61.001143a81.232457 81.232457 0 0 0 0-114.688l-2.486857-2.486857a80.852114 80.852114 0 0 0-57.344-23.698286c-20.772571 0-41.545143 7.899429-57.344 23.698286l-135.021714 135.021714c-31.597714 31.597714-31.597714 83.090286 0 114.834286l2.486857 2.486857c4.973714 4.973714 10.386286 9.069714 16.091428 12.434285l-49.444571 49.444572c-5.266286-4.096-10.386286-8.484571-15.36-13.312l-2.486857-2.486857c-58.221714-58.221714-58.221714-153.6 0-211.821715l135.021714-135.021714c29.257143-29.549714 67.730286-44.032 106.203429-44.032m-0.146286-70.802286c-28.672 0-56.466286 5.412571-82.944 16.091429a216.649143 216.649143 0 0 0-72.996571 48.420571l-135.021715 135.021715a219.574857 219.574857 0 0 0-64.512 155.940571c0 28.672 5.412571 56.466286 16.091429 82.944a216.649143 216.649143 0 0 0 48.420571 72.996572l2.486857 2.486857 0.292572 0.292571c6.729143 6.582857 13.897143 12.873143 21.942857 19.163429 12.726857 9.801143 27.940571 14.628571 43.154286 14.628571 18.139429 0 36.278857-7.021714 50.029714-20.772571l49.444571-49.444572a70.875429 70.875429 0 0 0 20.187429-58.660571 71.080229 71.080229 0 0 0-33.792-52.077714c-1.170286-0.731429-2.048-1.316571-2.633143-1.901715l-2.340571-2.340571a10.415543 10.415543 0 0 1 0-14.774857l135.021714-135.021715c2.486857-2.486857 5.412571-3.072 7.314286-3.072s4.827429 0.585143 7.314285 2.925715l2.486858 2.486857c2.486857 2.486857 3.072 5.412571 3.072 7.314286s-0.585143 4.827429-2.925715 7.314285l-61.001143 61.147429a70.656 70.656 0 0 0-15.506285 76.507428c7.021714 17.261714 10.386286 35.547429 10.093714 54.418286a70.5536 70.5536 0 0 0 70.656 71.68c18.432 0 36.425143-7.168 50.029714-20.772571l94.500572-94.500572a219.574857 219.574857 0 0 0 64.512-155.940571c0-28.672-5.412571-56.466286-16.091429-82.944a216.649143 216.649143 0 0 0-48.420571-72.996572l-2.486857-2.486857a219.574857 219.574857 0 0 0-72.996572-48.420571 232.301714 232.301714 0 0 0-83.382857-15.652572z" p-id="2579"></path><path d="M593.042286 433.005714c-4.827429-4.827429-9.947429-9.216-15.36-13.312l-49.444572 49.444572c5.705143 3.510857 11.264 7.460571 16.091429 12.434285l2.486857 2.486858c31.597714 31.597714 31.597714 83.090286 0 114.834285l-135.021714 135.021715a81.232457 81.232457 0 0 1-114.688 0l-2.340572-2.486858a81.232457 81.232457 0 0 1 0-114.688l61.001143-61.147428c-10.532571-26.185143-15.652571-54.125714-15.213714-81.92l-94.500572 94.354286c-58.221714 58.221714-58.221714 153.6 0 211.968l2.486858 2.486857c58.221714 58.221714 153.6 58.221714 211.968 0l135.021714-135.021715c58.221714-58.221714 58.221714-153.6 0-211.821714l-2.486857-2.633143z m0 0" fill="#FFFFFF" p-id="2580"></path><path d="M271.506286 664.137143c2.048-17.554286 9.801143-34.523429 23.113143-47.981714l61.001142-61.147429c-1.901714-4.534857-3.510857-9.216-4.973714-13.897143l-56.027428 56.027429a81.744457 81.744457 0 0 0-23.113143 66.998857zM546.962286 483.620571c13.458286 13.458286 21.065143 30.427429 23.113143 47.981715 2.779429-23.844571-4.973714-48.566857-23.113143-66.852572l-2.486857-2.486857c-1.609143-1.609143-3.364571-3.218286-5.12-4.681143l-11.117715 11.117715c5.705143 3.510857 11.264 7.460571 16.091429 12.434285l2.633143 2.486857z" fill="#C9C9C9" p-id="2581"></path><path d="M595.529143 628.150857l-135.021714 135.021714c-58.368 58.221714-153.6 58.221714-211.968 0l-2.486858-2.486857a149.123657 149.123657 0 0 1-43.446857-96.548571c-2.633143 41.545143 11.849143 83.821714 43.446857 115.419428l2.486858 2.486858c58.221714 58.221714 153.6 58.221714 211.968 0l135.021714-135.021715c31.451429-31.451429 45.933714-73.874286 43.446857-115.419428-2.194286 35.254857-16.676571 69.778286-43.446857 96.548571z" fill="#C9C9C9" p-id="2582"></path><path d="M792.576 238.445714l-2.486857-2.486857c-58.221714-58.221714-153.6-58.221714-211.821714 0l-135.021715 135.021714c-58.221714 58.221714-58.221714 153.6 0 211.821715l2.486857 2.486857c4.827429 4.827429 10.093714 9.216 15.36 13.312l49.444572-49.444572c-5.705143-3.510857-11.117714-7.460571-16.091429-12.434285l-2.486857-2.486857c-31.597714-31.597714-31.597714-83.090286 0-114.834286l135.021714-135.021714a81.232457 81.232457 0 0 1 114.688 0l2.486858 2.486857a81.232457 81.232457 0 0 1 0 114.688l-61.001143 61.147428c10.532571 26.185143 15.652571 54.125714 15.213714 81.92l94.500571-94.500571c57.929143-58.075429 57.929143-153.307429-0.292571-211.675429z m0 0" fill="#FFFFFF" p-id="2583"></path><path d="M460.946286 581.046857c-5.266286-4.096-10.386286-8.484571-15.36-13.312l-2.486857-2.486857A149.109029 149.109029 0 0 1 399.652571 468.114286c-2.340571 41.252571 11.995429 83.382857 43.446858 114.834285l2.486857 2.486858c4.827429 4.827429 10.093714 9.216 15.36 13.312l49.444571-49.444572c-3.657143-2.194286-7.021714-4.534857-10.386286-7.314286l-39.058285 39.058286zM741.376 284.525714l2.486857 2.486857c13.604571 13.604571 21.357714 30.866286 23.259429 48.566858 2.633143-23.552-5.12-48.128-23.259429-66.267429l-2.486857-2.486857a81.232457 81.232457 0 0 0-114.688 0l-135.021714 135.021714A81.144686 81.144686 0 0 0 468.406857 468.114286c1.901714-17.700571 9.654857-34.962286 23.259429-48.566857l135.021714-135.021715a81.232457 81.232457 0 0 1 114.688 0zM792.576 432.713143l-94.500571 94.500571c0.292571-23.259429-3.072-46.665143-10.532572-69.046857l-4.681143 4.681143c10.532571 26.185143 15.652571 54.125714 15.213715 81.92l94.500571-94.500571c31.305143-31.305143 45.787429-73.435429 43.446857-114.834286-2.194286 35.547429-16.530286 70.363429-43.446857 97.28z" fill="#C9C9C9" p-id="2584"></path><path d="M593.042286 433.005714c-4.827429-4.827429-9.947429-9.216-15.36-13.312l-49.444572 49.444572c5.705143 3.510857 11.264 7.460571 16.091429 12.434285l2.486857 2.486858c31.597714 31.597714 31.597714 83.090286 0 114.834285l-135.021714 135.021715a81.232457 81.232457 0 0 1-114.688 0l-2.340572-2.486858a81.232457 81.232457 0 0 1 0-114.688l61.001143-61.147428c-10.532571-26.185143-15.652571-54.125714-15.213714-81.92l-94.500572 94.354286c-58.221714 58.221714-58.221714 153.6 0 211.968l2.486858 2.486857c58.221714 58.221714 153.6 58.221714 211.968 0l135.021714-135.021715c58.221714-58.221714 58.221714-153.6 0-211.821714l-2.486857-2.633143z m0 0" fill="#FFFFFF" p-id="2585"></path><path d="M271.506286 664.137143c2.048-17.554286 9.801143-34.523429 23.113143-47.981714l61.001142-61.147429c-1.901714-4.534857-3.510857-9.216-4.973714-13.897143l-56.027428 56.027429a82.212571 82.212571 0 0 0-23.113143 66.998857zM546.962286 483.620571c13.458286 13.458286 21.065143 30.427429 23.113143 47.981715 2.779429-23.844571-4.973714-48.566857-23.113143-66.852572l-2.486857-2.486857c-1.609143-1.609143-3.364571-3.218286-5.12-4.681143l-11.117715 11.117715c5.705143 3.510857 11.264 7.460571 16.091429 12.434285l2.633143 2.486857z" fill="#C9C9C9" p-id="2586"></path><path d="M595.529143 628.150857l-135.021714 135.021714c-58.368 58.221714-153.6 58.221714-211.968 0l-2.486858-2.486857a149.123657 149.123657 0 0 1-43.446857-96.548571c-2.633143 41.545143 11.849143 83.821714 43.446857 115.419428l2.486858 2.486858c58.221714 58.221714 153.6 58.221714 211.968 0l135.021714-135.021715c31.451429-31.451429 45.933714-73.874286 43.446857-115.419428-2.194286 35.254857-16.676571 69.778286-43.446857 96.548571z" fill="#C9C9C9" p-id="2587"></path><path d="M792.576 238.445714l-2.486857-2.486857c-58.221714-58.221714-153.6-58.221714-211.821714 0l-135.021715 135.021714c-58.221714 58.221714-58.221714 153.6 0 211.821715l2.486857 2.486857c4.827429 4.827429 10.093714 9.216 15.36 13.312l49.444572-49.444572c-5.705143-3.510857-11.117714-7.460571-16.091429-12.434285l-2.486857-2.486857c-31.597714-31.597714-31.597714-83.090286 0-114.834286l135.021714-135.021714a81.232457 81.232457 0 0 1 114.688 0l2.486858 2.486857a81.232457 81.232457 0 0 1 0 114.688l-61.001143 61.147428c10.532571 26.185143 15.652571 54.125714 15.213714 81.92l94.500571-94.500571c57.929143-58.075429 57.929143-153.307429-0.292571-211.675429z m0 0" fill="#FFFFFF" p-id="2588"></path><path d="M460.946286 581.046857c-5.266286-4.096-10.386286-8.484571-15.36-13.312l-2.486857-2.486857A149.109029 149.109029 0 0 1 399.652571 468.114286c-2.340571 41.252571 11.995429 83.382857 43.446858 114.834285l2.486857 2.486858c4.827429 4.827429 10.093714 9.216 15.36 13.312l49.444571-49.444572c-3.657143-2.194286-7.021714-4.534857-10.386286-7.314286l-39.058285 39.058286zM741.376 284.525714l2.486857 2.486857c13.604571 13.604571 21.357714 30.866286 23.259429 48.566858 2.633143-23.552-5.12-48.128-23.259429-66.267429l-2.486857-2.486857a81.232457 81.232457 0 0 0-114.688 0l-135.021714 135.021714A81.144686 81.144686 0 0 0 468.406857 468.114286c1.901714-17.700571 9.654857-34.962286 23.259429-48.566857l135.021714-135.021715c31.744-31.597714 83.090286-31.597714 114.688 0zM792.576 432.713143l-94.500571 94.500571c0.292571-23.259429-3.072-46.665143-10.532572-69.046857l-4.681143 4.681143c10.532571 26.185143 15.652571 54.125714 15.213715 81.92l94.500571-94.500571c31.305143-31.305143 45.787429-73.435429 43.446857-114.834286-2.048 35.547429-16.530286 70.363429-43.446857 97.28z" fill="#C9C9C9" p-id="2589"></path></svg>`;
  public init(menu) {
    if (!EnvConfig.ins.isMobile) {
      // EnvConfig.ins.plugin.addTopBar({
      //   icon: CUSTOM_ICON_MAP.BacklinkPanelFilter.id,
      //     title: "反链面板页签",
      //     position: "right",
      //     callback: () => {
      //         let currentDocument: HTMLDivElement = getActiveTab();
      //         if (!currentDocument) {
      //             return;
      //         }

      //         const docTitleElement = currentDocument.querySelector(".protyle-title");
      //         let docTitle = currentDocument.querySelector("div.protyle-title__input").textContent;
      //         let docId = docTitleElement.getAttribute("data-node-id");
      //         TabService.ins.openBacklinkTab(docTitle, docId, null);
      //     }
      // });

      menu.addItem({
        label: "反链面板页签",
        iconHTML: `<div id="${CUSTOM_ICON_MAP.BacklinkPanelFilter.id}" class="toolbar__item b3-tooltips b3-tooltips__se" aria-label="打开仪表盘" >${this.icon}</div>`,
        click: async () => {
          openSettingsDialog();
        },
      });
    }
  }
}
